.\" man page template. See intro.l for more stuff to use
.\" see mdoc for list of valid commands
.\" Convert with groff:
.\" groff -m man -T xhtml aflock.1 > aflock.html
.Dd May 20, 2019
.Dt AFLOCK 1
.Sh NAME
.Nm aflock
.Nd the contact assigner in chromflock.
.Sh SYNOPSIS
.Sy aflock
.Op Fl A Fl Fl aFile Ar fname
.Op Fl l Fl Fl low Ar th
.Op Fl h Fl Fl high Ar th
.Op Fl n Fl Fl nStruct Ar N
.Op Fl R Fl Fl radius Ar R
.Op Fl Q Fl Fl vq Ar q
.Op Fl m Fl Fl mArgs Ar args
.Op Fl I Fl Fl init
.Op Fl F Fl Fl final
.Op Fl U Fl Fl update
.Op Fl B Fl Fl blockupdate
.Op Fl S Fl Fl score
.Op Fl Fl rpos Ar fname
.Op Fl Fl prpos Ar fname
.Ys
.Sh DESCRIPTION
.Nm aflock
is to be used before, between and after 
.Nm mflock
is used. Typically in a script generated by
.Nm chromflock.
.Nm aflock 
can be used to initialize
.Ar N 
new structures (or actually their W matrices), it can also be used to
update the W matrices by moving contacts between them, or to add more contacts to them.
.Pp 
The contact probability matix, passed as the 
.Ar aFile
is supposed to be a [NxN] symmetric matrix stored linearly and encoded as 'double'. 
Since the A matrix should be symmetric either row or column order will work. 
.Pp
If the same radial preference is to be enforced for all structures, this can be passed directly as an argument to
.Nm mflock 
(use the -mArgs argument).
To assign a radial preference with some probability to each structure, use the --rpos and --prpos pair of arguments.
That will generate a separate file with radial constrains for each structure which is updated in the same way as W by
.Nm aflock.
.Pp
.Sh MODES
There are three modes, in initialization mode ( 
.Fl --init
), the entries (m,n) where A_mn=1 are assigned to all W matrices.
In update mode, (
.Fl --update
) the contact maps, W, are updated with more contacts, or the contacts are re-distributed among them.
The finalization mode (
.Fl --final
) is used to creates some summary statistics.
.Sh OPTIONS
.\" Begin list, ends with .El 
.Bl -tag -width Fl
.It Fl A Ar file , Fl Fl aFile Ar file
Specifies a file that contains the contact probability matrix.
.It Fl Q, Fl Fl vq Ar q
Sets the volume quotient,
.Ar q
of the beads, i.e. how large the volume of all beads should be in contrast to the volume of the nucleus. 
By specifying a volume quotient, the bead radius will be set and hence it is not possible to use -Q and -R simultaneously.
.It Fl l Ar th, Fl Fl low th
Sets the lower threshold to use, i.e., the lowest values of A to use.
.It Fl h Ar th, Fl Fl high th
Sets the lower threshold to use, i.e., the highest values of A to use.
.It Fl R Ar r0, Fl Fl radius Ar r0
Sets the radius of all beads to 
Ar r0 
(they can't be set individually). Probably you would like to use 
.Fl Q
instead.
.It Fl m Ar args, Fl Fl mArgs Ar args
Set the arguments to be used by mflock, these will be passed over to the file named mflock_jobs that will be created.
.It Fl I, Fl Fl init
Set the mode to initialization.
.It Fl U, Fl Fl update
Set the mode to update.
.It Fl B, Fl Fl blockupdate
Set the mode to update, and blocks failed contacts be assigned again.
.It Fl F, Fl Fl final
Set the mode to finialization.
.It Fl h, Fl Fl help
Show a brief help message.
.It Fl Fl rpos Ar fname
Specifies a file that contains the radial preferences for each bead. The file should be encoded as double. 
Only to be used together with --prpos.
.It Fl Fl prpos Ar fname
Specifies a file that contains the probability or proportion of structures that should have each radial constraint. 
The file should be encoded as double. Only to be used with --rpos.
.El
.Sh EXAMPLES
See the script `/util/chromflock_gen`.
.Ss Basic usage:
Initialize 10,000 structures using the contact probability matrix in A.double and give the beads a total volume that is 20% of the nuclei.
.Pp
$ aflock --init --aFile A.double --nStruct 10000 --vq 0.02
.Sh SEE ALSO
chromflock, mflock
